<!DOCTYPE html>
<!--Stephen Rong, Biol 2430: Final Project-->

<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Page Template</title>
        <script type="text/javascript" src="d3/d3.js"></script>
        <style type="text/css">
            /*p {font-family: verdana;}*/
            .axis line,
            .axis path {
              fill: none;
              stroke: #000;
              shape-rendering: crispEdges;
            },
            .axis text {
              text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
            }
        </style>
    </head>
    <body>
        <script type="text/javascript">
            // Preliminaries
            var body = d3.select("body")
            var margin = {top: 30, right: 10, bottom: 10, left: 10}
            var w = 960
            var h = 500
            var padding = 100
            var width = w - margin.left - margin.right
            var height = h - margin.top - margin.bottom

            // Data Variables
            var data_ne, data_hs, data_hl, data_ss, data_sl
            // Data Labels
            var label = {"ne": "Neutral", "hs": "Hard Sweeps", "hl": "Linked to Hard Sweeps", "ss": "Soft Sweeps", "sl": "Linked to Soft Sweeps"}
            // Data Mapping
            var data = {"ne": data_ne, "hs": data_hs, "hl": data_hl, "ss": data_ss, "sl": data_sl}
            // Data Coloring
            var color = {"ne": "#D4A2E1", "hs": "#ECBB3D", "hl": "#C1DD45", "ss": "#55E0C6", "sl": "#73E162"}

            // Data Loading  // load datasets in sequence and then execute main function
            d3.tsv("data-ne.txt", function(error, data) {
                data_ne = data
                // console.log(data_ne)
                d3.tsv("data-hs.txt", function(error, data) {
                    data_hs = data
                    // console.log(data_hs)
                    d3.tsv("data-hl.txt", function(error, data) {
                        data_hl = data
                        // console.log(data_hl)
                        d3.tsv("data-ss.txt", function(error, data) {
                            data_ss = data
                            // console.log(data_ss)
                            d3.tsv("data-sl.txt", function(error, data) {
                                data_sl = data
                                // console.log(data_sl)
                                main()
                            })
                        })
                    })
                })
            })

            // Main
            function main() {
                // Preliminaries
                var heading = body.append("p")
                    .text("Visualizing Summary Statistics for Selection - Stephen Rong - Biol 2430: Interacting with Data")

                var svg = body.append("svg")
                    .attr("width", w)
                    .attr("height", h)
                // var xscale = d3.scale.linear().domain([-1*w/h, 1*w/h]).range([padding, w-padding])
                var xscale = d3.scale.linear().domain([0, 1]).range([padding, w-padding])
                var yscale = d3.scale.linear().domain([-1, 1]).range([h-padding, padding])

                datafull = data_ne.concat(data_hs).concat(data_hl).concat(data_ss).concat(data_sl)
                // console.log(datafull)

                // List of Summary Statistics
                var keylist = d3.keys(data_ne[0])
                keylist.splice(keylist.indexOf("sclass"), 1)
                keylist.splice(keylist.indexOf("MAF_1"), 1)
                keylist.splice(keylist.indexOf("DAF_1"), 1)
                keylist.splice(keylist.indexOf("Theta1Pi_1"), 1)
                keylist.splice(keylist.indexOf("Theta1S_1"), 1)
                keylist.splice(keylist.indexOf("Theta1H_1"), 1)
                keylist.splice(keylist.indexOf("Theta1L_1"), 1)
                keylist.splice(keylist.indexOf("Theta1Xi_1"), 1)

                // Temporary Lists
                var keylisttemp = ["DDAF_1", "TajD_1", "H1_1", "ThetaPi_1"]
                var keylistcomp = keylist.slice()
                for (i = 0; i < keylisttemp.length; i++) {
                    keylistcomp.splice(keylistcomp.indexOf(keylisttemp[i]), 1)
                }
                // console.log(keylisttemp)
                // console.log(keylistcomp)

                // Axes
                var axeslist = []
                for (i = 0; i < keylist.length; i++) {
                    axeslist.push(
                        d3.svg.axis()
                            .scale(d3.scale.linear().domain([-1-i*0.1, 1+i*0.1]).range([h-padding, padding]))
                            .orient("left")
                            .ticks(10)
                    )
                }

                var axestemp = []
                for (i = 0; i < keylisttemp.length; i++) {
                    axestemp.push(axeslist[keylist.indexOf(keylisttemp[i])])
                }

                var axescomp = []
                for (i = 0; i < keylistcomp.length; i++) {
                    axescomp.push(axeslist[keylist.indexOf(keylistcomp[i])])
                }

                for (i = 0; i < keylisttemp.length; i++) {
                    svg.append("g")
                        .transition()
                        .call(axestemp[i])
                        .attr("class", keylisttemp[i]+" axis")
                        .attr("transform", "translate(" + (xscale((i+1)/(keylisttemp.length+1))) + ",0)")
                }

                for (i = 0; i < keylistcomp.length; i++) {
                    svg.append("g")
                        .transition()
                        .call(axescomp[i])
                        .attr("class", keylistcomp[i]+" axis")
                        .attr("transform", "translate(-100, 0)")
                }

                // List
                body.selectAll("p")
                    .data(keylistcomp)
                    .enter()
                    .append("p")
                    .text(function(d) {
                        return d
                    })

                // Transitions
                // gaxes = svg.selectAll("g")

                // Click on Name  // should transition from right
                body.selectAll("p")
                    .on("click", function() {
                        d3.select(this)
                            .transition()
                            .remove()
                        value = this.innerHTML

                        keylisttemp.push(value)
                        keylistcomp.splice(keylistcomp.indexOf(value), 1)
                        axestemp.push(axeslist[keylist.indexOf(keylisttemp[keylisttemp.length-1])])
                        axescomp.splice(axescomp.indexOf(value), 1)
                        // console.log(keylisttemp)
                        // console.log(keylistcomp)

                        for (i = 0; i < keylisttemp.length; i++) {
                            svg.select("."+keylisttemp[i]+".axis")
                                .transition()
                                .attr("transform", "translate(" + (xscale((i+1)/(keylisttemp.length+1))) + ",0)")
                        }
                    })

                // Click on Axis
                svg.selectAll("g")
                    .on("click", function() {
                        temp = this.getAttribute("class").split(" ")[0]
                        if (temp != "tick") {
                            value = temp
                            console.log(value)

                            d3.select(this)
                                .transition()
                                .attr("transform", "translate(-100, 0)")

                            keylistcomp.push(value)
                            keylisttemp.splice(keylisttemp.indexOf(value), 1)
                            axescomp.push(axeslist[keylist.indexOf(keylistcomp[keylistcomp.length-1])])
                            axestemp.splice(axestemp.indexOf(value), 1)
                            console.log(keylisttemp)
                            console.log(keylistcomp)

                            for (i = 0; i < keylisttemp.length; i++) {
                                svg.select("."+keylisttemp[i]+".axis")
                                    .transition()
                                    .attr("transform", "translate(" + (xscale((i+1)/(keylisttemp.length+1))) + ",0)")
                            }
                        }
                    })

                // Test
                // svg.append("circle").attr("cx", xscale(0)).attr("cy", yscale(0)).attr("r", 5)
            }

        </script>
    </body>
</html>